---
title: Step 4 - Installing the PGD software
navTitle: Installing PGD software
deepToC: true
---

## Installing the PGD software

With the repositories configured, you can now install the Postgres Distributed software. 
These steps must be carried out on each host.

* Install the PGD packages which include a server specific BDR package and generic PGD proxy and cli packages.
* Initialise the Postgres database.
* Add the BDR extension to the shared_preload_libraries setting in `postgresql.conf`.
* Set the `wal_level` GUC variable to `logical` in `postgresql.conf`.
* Turn on commit timestamp tracking by setting `track_commit_timestamp` to `'on'` in `postgresql.conf`.
* Set a password on the EnterprisedDB/Postgres user.
* Raise the maximum worker processes to 16 by setting `max_worker_processes` to `'16'` in `postgresql.conf`.
* Add rules to `pg_hba.conf` to allow nodes to connect to each other.
* Add a `.pgpass` file to allow nodes to authenticate each other.
* Restart the server.
* Log into the server's default database (`ebd` for EPAS, `postgres` for PGE and Community).
* Use `CREATE DATABASE bdrdb` to create the default PGD replicated database.
* Log out and then log back in to `bdrdb`.
* Use `CREATE EXTENSION bdr` to enable the BDR extension and PGD to run on that database.

We will look in detail the steps for EDB Postgres Advanced Server in the worked example below. 

If you are installing PGD with EDB Postgres Extended Server or Community Postgres, the steps are similar, but details such as package names and paths are different. These differences are summarized in [Installing PGD for EDB Postgres Extended Server](#installing_pgd_for_edb_postgres_extended_server) and [Installing PGD for Community Postgresql](#installing_pgd_for_community_postgresql).

## Worked example

### Install the packages

The first step is to install the packages. For each Postgres package, there is a `edb-bdr5-<postgresversion>` package to go with it. 
For example, if we are installing EDB Postgres Advanced Server (epas) version 16, we would install `edb-bdr5-epas16`. 

There are two other packages to also install: `edb-pgd5-proxy` for PGD Proxy and `edb-pgd5-cli` for the PGD command line tool.

To install all of these packages on a RHEL or RHEL compatible Linux, run:

```
sudo dnf -y install edb-bdr5-epas16 edb-pgd5-proxy edb-pgd5-cli
```

### Initializing and starting the database

Now initialise the database. You will need to know the path to the setup script for your particular Postgres. 
For EDB Postgres Advanced Server, this script can be found in `/usr/edb/as16/bin` as `edb-as-16-setup`. 
This command needs to be run with the `initdb` parameter and we need to pass an option setting the database to use UTF-8.


```
sudo PGSETUP_INITDB_OPTIONS="-E UTF-8" /usr/edb/as16/bin/edb-as-16-setup initdb
```

Once the database is initialised, we will start it which will enable us to continue configuring the BDR extension.

```
sudo systemctl start edb-as-16
```

### Configuring the BDR extension

Installing EDB Postgres Advanced Server creates a system user `enterprisedb` with admin capabilities when connected to the database.

#### Preload the BDR library

We want the bdr library to be preloaded with other libraries. 
EPAS has a number of libraries already preloaded, so we have to prefix the existing list the the BDR library.

```
echo -e "shared_preload_libraries = '\$libdir/bdr,\$libdir/dbms_pipe,\$libdir/edb_gen,\$libdir/dbms_aq'" | sudo -u enterprisedb tee -a /var/lib/edb/as16/data/postgresql.conf >/dev/null
```

!!!tip
This command format (`echo ... | sudo ... tee ...`) appends the echoed string to the end of the postgresql.conf file which is owned by another user.
!!!

#### Set the `wal_level`

The BDR extension needs to set the server to perform logical replication. We do this by settin `wal_level` to `logical`.

```
echo -e "wal_level = 'logical'" | sudo -u enterprisedb tee -a /var/lib/edb/as16/data/postgresql.conf >/dev/null
```

#### Enable commit timestamp tracking

The BDR extension also needs the commit timestamp tracking enabled.

```
echo -e "track_commit_timestamp = 'on'" | sudo -u enterprisedb tee -a /var/lib/edb/as16/data/postgresql.conf >/dev/null
```

#### Add a password to the Postgres enterprisedb user

To allow connections between nodes, a password needs to be set on the Postgres enterprisedb user. 
For this example, we are using the password `secret`.
Select a different password for your deployments.
You will need this password when we get to [Connecting the Cluster](05-connecting-cluster).

```
sudo -u enterprisedb psql edb -c "ALTER USER enterprisedb WITH PASSWORD 'secret'"
```

#### Raise `max_worker_processes`

To communicate between multiple nodes, Postgres Distributed nodes run more worker processes than usual.
The default limit (8) is too low even for a small cluster.

Raise the maximum number of worker processes with this commmand:

```
echo -e "max_worker_processes = '16'" | sudo -u enterprisedb tee -a /var/lib/edb/as16/data/postgresql.conf >/dev/null
```

The `max_worker_processes` value should be raised for larger clusters.
To calculate the needed value see [Postgres configuration/settings](../postgres-configuration/#postgres-settings).

#### Enable node communications in pg_hba.conf

Out of the box, Postgres allows local communications with the database but not external network connections. 
To enable this, edit `pg_hba.conf` and add appropriate rules, including rules for the replication users.
To simplify the process, use this command:

```
echo -e "host all all all md5\nhost replication all all md5" | sudo tee -a /var/lib/edb/as16/data/pg_hba.conf
```

It will append

```
host all all all md5
host replication all all md5
```

to `pg_hba.conf` which will enable the nodes to replicate.

#### Enable authentication between nodes

As part of the process of connecting nodes for replication, PGD logs into other nodes. 
It will perform that log in as the user that Postgres is running under.
For epas, this is the `enterprisedb` user.
That user will need credentials to log into the other nodes.
We will supply these credentials using the `.pgpass` file which needs to reside in the user's home directory.
The home directory for `enterprisedb` is `/var/lib/edb`.

Run this command to create the file:

```
echo -e "*:*:*:enterprisedb:secret" | sudo -u enterprisedb tee /var/lib/edb/.pgpass; sudo chmod 0600 /var/lib/edb/.pgpass
```

### Restart the server

After all these configuration changes, it is recommended that the server is restarted with:

```
sudo systemctl restart edb-as-16
```

### Create the replicated database

The server is now prepared for PGD. 
We need to next create a database named `bdrdb` and install the bdr extension when logged into it.

```
sudo -u enterprisedb psql edb -c "CREATE DATABASE bdrdb"
sudo -u enterprisedb psql bdrdb -c "CREATE EXTENSION bdr"
```

Finally, test the connection by logging into the server.

```
sudo -u enterprisedb psql bdrdb
```

You should be connected to the server. 


## Summaries

### Installing PGD for EDB Postgres Advanced Server

These are all the commands used in this section gathered together for your convenience.

```
sudo dnf -y install edb-bdr5-epas16 edb-pgd5-proxy edb-pgd5-cli
sudo PGSETUP_INITDB_OPTIONS="-E UTF-8" /usr/edb/as16/bin/edb-as-16-setup initdb
sudo systemctl start edb-as-16
echo -e "shared_preload_libraries = '\$libdir/bdr,\$libdir/dbms_pipe,\$libdir/edb_gen,\$libdir/dbms_aq'" | sudo -u enterprisedb tee -a /var/lib/edb/as16/data/postgresql.conf >/dev/null
echo -e "wal_level = 'logical'" | sudo -u enterprisedb tee -a /var/lib/edb/as16/data/postgresql.conf >/dev/null
echo -e "track_commit_timestamp = 'on'" | sudo -u enterprisedb tee -a /var/lib/edb/as16/data/postgresql.conf >/dev/null
echo -e "max_worker_processes = '16'" | sudo -u enterprisedb tee -a /var/lib/edb/as16/data/postgresql.conf >/dev/null
sudo -u enterprisedb psql edb -c "ALTER USER enterprisedb WITH PASSWORD 'secret'"
echo -e "host all all all md5\nhost replication all all md5" | sudo tee -a /var/lib/edb/as16/data/pg_hba.conf >/dev/null
echo -e "*:*:*:enterprisedb:secret" | sudo -u enterprisedb tee /var/lib/edb/.pgpass >/dev/null; sudo chmod 0600 /var/lib/edb/.pgpass
sudo systemctl restart edb-as-16
sudo -u enterprisedb psql edb -c "CREATE DATABASE bdrdb"
sudo -u enterprisedb psql bdrdb -c "CREATE EXTENSION bdr"
sudo -u enterprisedb psql bdrdb
```

### Installing PGD for EDB Postgres Extended Server

If installing PGD with EDB Postgres Extended Server, there are a number of differences from the EPAS installation.

* The BDR package to install is named `edb-bdrV-pgextendedNN` (where V is the PGD version and NN is the PGE version number)
* A different setup utility should be called: /usr/edb/pgeNN/bin/edb-pge-NN-setup 
* The service name is edb-pge-NN.
* The system user is postgres (not enterprisedb)
* The home directory for the postgres user is `/var/lib/pgqsl`
* There are no pre-existing libraries to be added to `shared_preload_libraries`

#### Summary: Installing PGD for EDB Postgres Extended Server 16

```
sudo dnf -y install edb-bdr5-pgextended16 edb-pgd5-proxy edb-pgd5-cli
sudo PGSETUP_INITDB_OPTIONS="-E UTF-8" /usr/edb/pge16/bin/edb-pge-16-setup initdb
sudo systemctl start edb-pge-16
echo -e "shared_preload_libraries = '\$libdir/bdr'" | sudo -u postgres tee -a /var/lib/edb-pge/16/data/postgresql.conf >/dev/null
echo -e "wal_level = 'logical'" | sudo -u postgres tee -a /var/lib/edb-pge/16/data/postgresql.conf >/dev/null
echo -e "track_commit_timestamp = 'on'" | sudo -u postgres tee -a /var/lib/edb-pge/16/data/postgresql.conf >/dev/null
echo -e "max_worker_processes = '16'" | sudo -u postgres tee -a /var/lib/edb-pge/16/data/postgresql.conf >/dev/null
sudo -u postgres psql postgres -c "ALTER USER postgres WITH PASSWORD 'secret'"
echo -e "host all all all md5\nhost replication all all md5" | sudo tee -a /var/lib/edb-pge/16/data/pg_hba.conf >/dev/null
echo -e "*:*:*:postgres:secret" | sudo -u postgres tee /var/lib/pgsql/.pgpass >/dev/null; sudo chmod 0600 /var/lib/pgsql/.pgpass
sudo systemctl restart edb-pge-16
sudo -u postgres psql postgres -c "CREATE DATABASE bdrdb"
sudo -u postgres psql bdrdb -c "CREATE EXTENSION bdr"
sudo -u postgres psql bdrdb
```

### Installing PGD for Community Postgresql

If installing PGD with Community PostgresSQL, there are a number of differences from the EPAS installation.

* The BDR package to install is named `edb-bdrV-pgNN` (where V is the PGD version and NN is the PostgreSQL version number)
* A different setup utility should be called: /usr/pgsql-NN/bin/postgresql-NN-setup 
* The service name is postgresql-NN.
* The system user is postgres (not enterprisedb)
* The home directory for the postgres user is `/var/lib/pgqsl`
* There are no pre-existing libraries to be added to `shared_preload_libraries`

#### Summary: Installing PGD for Postgresql 16

```
sudo dnf -y install edb-bdr5-pg16 edb-pgd5-proxy edb-pgd5-cli
sudo PGSETUP_INITDB_OPTIONS="-E UTF-8" /usr/pgsql-16/bin/postgresql-16-setup initdb
sudo systemctl start postgresql-16
echo -e "shared_preload_libraries = '\$libdir/bdr'" | sudo -u postgres tee -a /var/lib/pgsql/16/data/postgresql.conf >/dev/null
echo -e "wal_level = 'logical'" | sudo -u postgres tee -a /var/lib/pgsql/16/data/postgresql.conf >/dev/null
echo -e "track_commit_timestamp = 'on'" | sudo -u postgres tee -a /var/lib/pgsql/16/data/postgresql.conf >/dev/null
echo -e "max_worker_processes = '16'" | sudo -u postgres tee -a /var/lib/pgsql/16/data/postgresql.conf >/dev/null
sudo -u postgres psql postgres -c "ALTER USER postgres WITH PASSWORD 'secret'"
echo -e "host all all all md5\nhost replication all all md5" | sudo tee -a /var/lib/pgsql/16/data/pg_hba.conf >/dev/null
echo -e "*:*:*:postgres:secret" | sudo -u postgres tee /var/lib/pgsql/.pgpass; sudo chmod 0600 /var/lib/pgsql/.pgpass
sudo systemctl restart postgresql-16
sudo -u postgres psql postgres -c "CREATE DATABASE bdrdb"
sudo -u postgres psql bdrdb -c "CREATE EXTENSION bdr"
sudo -u postgres psql bdrdb
```


