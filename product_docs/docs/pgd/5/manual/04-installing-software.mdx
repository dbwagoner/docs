---
title: Installing software
deepToC: true
---

With the repositories configured, you can now install the Postgres Distributed software. 
These steps must be carried out on each node.

We will detail the steps for EDB Postgres Advanced Server below. If you are installing PGD with EDB Postgres Extended Server or Community Postgres, the steps are similar, but details such as package names and paths are different. These differences are summarized in [Installing PGD for EDB Postgres Extended Server](#installing_pgd_for_edb_postgres_extended_server) and [Installing PGD for Community Postgresql](#installing_pgd_for_community_postgresql).

## Installing PGD for EDB Postgres Advanced Server

### Install the packages

The first step is to install the packages. For each Postgres package, there is a `edb-bdr5-<postgresversion>` package to go with it. 
In our example, we are installing EDB Postgres Advanced Server (epas) version 16, and so will install `edb-bdr5-epas16`. 

There are two other packages to also install: `edb-pgd5-proxy` for PGD Proxy and `edb-pgd5-cli` for the PGD command line tool.

To install all of these packages on a RHEL or RHEL compatible Linux, run:

```
sudo dnf -y install edb-bdr5-epas16 edb-pgd5-proxy edb-pgd5-cli
```

### Initializing and starting the database

Now initialise the database. You will need to know the path to the setup script for your particular Postgres. 
For EDB Postgres Advanced Server, this script can be found in `/usr/edb/as16/bin` as `edb-as-16-setup`. 
This command needs to be run with the `initdb` parameter and we need to pass an option setting the database to use UTF-8.


```
sudo PGSETUP_INITDB_OPTIONS="-E UTF-8" /usr/edb/as16/bin/edb-as-16-setup initdb
```

Once the database is initialised, we will start it which will enable us to continue configuring the BDR extension.

```
sudo systemctl start edb-as-16
```

### Configuring the BDR extension

Installing EDB Postgres Advanced Server creates a system user `enterprisedb` with admin capabilities when connected to the database.
In the following steps, we use the sudo command to take on the role of this user and then run the psql command to connect to the default `edb` database:

```
sudo -u enterprisedb psql edb -c <SQL COMMAND>
```

#### Preload the BDR library

We want the bdr library to be preloaded with other libraries. 
EPAS has a number of libraries already preloaded, so we have to prefix the existing list the the BDR library.

```
sudo -u enterprisedb psql edb -c "ALTER SYSTEM SET shared_preload_libraries TO '\$libdir/bdr','\$libdir/dbms_pipe','\$libdir/edb_gen','\$libdir/dbms_aq'"
```

The ALTER SYSTEM SET command adds the configuration change to the `postgresql.auto.conf` file.

#### Set the `wal_level`

The BDR extension needs to set the server to perform logical replication. We do this by settin `wal_level` to `logical`.

```
sudo -u enterprisedb psql edb -c "ALTER SYSTEM SET wal_level TO 'logical'"
```

#### Enable commit timestamp tracking

The BDR extension also needs the commit timestamp tracking enabled.

```
sudo -u enterprisedb psql edb -c "ALTER SYSTEM SET track_commit_timestamp TO 'on'"
```

#### Add a password to the Postgres enterprisedb user

To allow connections between nodes, a password needs to be set on the Postgres enterprisedb user. 
For this example, we are using the password `secret`.
Select a different password for your deployments.
You will need this password when we get to [Connecting the Cluster](05-connecting-cluster).

```
sudo -u enterprisedb psql edb -c "ALTER USER enterprisedb WITH PASSWORD 'secret'"
```

#### Raise `max_worker_processes`

To communicate between multiple nodes, Postgres Distributed nodes run more worker processes than usual.
The default limit (8) is too low even for a small cluster.

Raise the maximum number of worker processes with this commmand:

```
sudo -u enterprisedb psql edb -c "ALTER SYSTEM SET max_worker_processes TO '16'"
```

The `max_worker_processes` value should be raised for larger clusters.
To calculate the needed value see [Postgres configuration/settings](../postgres-configuration/#postgres-settings).

#### Enable node communications in pg_hba.conf

Out of the box, Postgres allows local communications with the database but not external network connections. 
To enable this, edit `pg_hba.conf` and add appropriate rules, including rules for the replication users.
To simplify the process, use this command:

```
echo -e "host all all all md5\nhost replication all all md5" | sudo tee -a /var/lib/edb/as16/data/pg_hba.conf
```

It will append

```
host all all all md5
host replication all all md5
```

to `pg_hba.conf` which will enable the nodes to replicate.

### Restart the server

After all these configuration changes, it is recommended that the server is restarted with:

```
sudo systemctl restart edb-as-16
```

### Create the replicated database

The server is now prepared for PGD. 
We need to next create a database named `bdrdb` and install the bdr extension when logged into it.

```
sudo -u enterprisedb psql edb -c "CREATE DATABASE bdrdb"
sudo -u enterprisedb psql bdrdb -c "CREATE EXTENSION bdr"
```

Finally, test the connection by logging into the server.

```
sudo -u enterprisedb psql bdrdb
```

You should be connected to the server. 



## Summary: Installing PGD for EDB Postgres Advanced Server

These are all the commands used in this section gathered together for your convenience.

```
sudo dnf -y install edb-bdr5-epas16 edb-pgd5-proxy edb-pgd5-cli
sudo PGSETUP_INITDB_OPTIONS="-E UTF-8" /usr/edb/as16/bin/edb-as-16-setup initdb
sudo systemctl start edb-as-16
sudo -u enterprisedb psql edb -c "ALTER SYSTEM SET shared_preload_libraries TO '\$libdir/bdr','\$libdir/dbms_pipe','\$libdir/edb_gen','\$libdir/dbms_aq'"
sudo -u enterprisedb psql edb -c "ALTER SYSTEM SET wal_level TO 'logical'"
sudo -u enterprisedb psql edb -c "ALTER SYSTEM SET track_commit_timestamp TO 'on'"
sudo -u enterprisedb psql edb -c "ALTER USER enterprisedb WITH PASSWORD 'secret'"
sudo -u enterprisedb psql edb -c "ALTER SYSTEM SET max_worker_processes TO '16'"
echo -e "host all all all md5\nhost replication all all md5" | sudo tee -a /var/lib/edb/as16/data/pg_hba.conf
sudo systemctl restart edb-as-16
sudo -u enterprisedb psql edb -c "CREATE DATABASE bdrdb"
sudo -u enterprisedb psql bdrdb -c "CREATE EXTENSION bdr"
sudo -u enterprisedb psql bdrdb
```

## Other Postgres Installations

### Installing PGD for EDB Postgres Extended Server

If installing PGD with EDB Postgres Extended Server, there are a number of differences from the EPAS installation.

* The BDR package to install is named `edb-bdr-pgextendedNN` (where NN is the PGE version number)
* A different setup utility should be called: /usr/edb/pgeNN/bin/edb-pge-NN-setup 
* The service name is edb-pge-NN.
* The system user is postgres (not enterprisedb)
* There are no pre-existing libraries to be added to `shared_preload_libraries`

#### Summary: Installing PGD for EDB Postgres Extended Server 16

```
sudo dnf -y install install edb-bdr5-pgextended16 edb-pgd5-proxy edb-pgd5-cli
sudo PGSETUP_INITDB_OPTIONS="-E UTF-8" /usr/edb/pge16/bin/edb-pge-16-setup initdb
sudo systemctl start edb-pge-16
sudo -u postgres psql postgres -c "ALTER SYSTEM SET shared_preload_libraries TO '\$libdir/bdr'"
sudo -u postgres psql postgres -c "ALTER SYSTEM SET wal_level TO 'logical'"
sudo -u postgres psql postgres -c "ALTER SYSTEM SET track_commit_timestamp TO 'on'"
sudo -u postgres psql postgres -c "ALTER USER postgres WITH PASSWORD 'secret'"
sudo -u postgres psql postgres -c "ALTER SYSTEM SET max_worker_processes TO '16'"
echo -e "host all all all md5\nhost replication all all md5" | sudo tee -a /var/lib/edb-pge/16/data/pg_hba.conf
sudo systemctl restart edb-pge-16
sudo -u postgres psql postgres -c "CREATE DATABASE bdrdb"
sudo -u postgres psql bdrdb -c "CREATE EXTENSION bdr"
sudo -u postgres psql bdrdb
```

### Installing PGD for Community Postgresql

If installing PGD with Community PostgresSQL, there are a number of differences from the EPAS installation.

* The BDR package to install is named `edb-bdr-pgNN` (where NN is the PostgreSQL version number)
* A different setup utility should be called: /usr/pgsql-NN/bin/postgresql-NN-setup 
* The service name is postgresql-NN.
* The system user is postgres (not enterprisedb)
* There are no pre-existing libraries to be added to `shared_preload_libraries`

* If you are installing Community Postgres (postgres) version 14, then the `postgresversion` value is `pg14`.
* If you are installing EDB Postgres Extended (pgextended) version 15, then the `postgresversion` value would be `pgextended15`
* If you are installing EDB Postgres Advanced Server (epas) version 16, then that value is `epas16`.

#### Summary: Installing PGD for Postgresql 16

```
sudo dnf -y install edb-bdr5-pg16 edb-pgd5-proxy edb-pgd5-cli
sudo PGSETUP_INITDB_OPTIONS="-E UTF-8" /usr/pgsql-16/bin/postgresql-16-setup initdb
sudo systemctl start postgresql-16
sudo -u postgres psql postgres -c "ALTER SYSTEM SET shared_preload_libraries TO '\$libdir/bdr'"
sudo -u postgres psql postgres -c "ALTER SYSTEM SET wal_level TO 'logical'"
sudo -u postgres psql postgres -c "ALTER SYSTEM SET track_commit_timestamp TO 'on'"
sudo -u postgres psql postgres -c "ALTER USER postgres WITH PASSWORD 'secret'"
sudo -u postgres psql postgres -c "ALTER SYSTEM SET max_worker_processes TO '16'"
echo -e "host all all all md5\nhost replication all all md5" | sudo tee -a /var/lib/pgsql/16/data/pg_hba.conf
sudo systemctl restart postgresql-16
sudo -u postgres psql postgres -c "CREATE DATABASE bdrdb"
sudo -u postgres psql bdrdb -c "CREATE EXTENSION bdr"
sudo -u postgres psql bdrdb
```


