---
title: Creating the PGD Cluster
---

So far, we have:

* Created three Hosts.
* Installed a Postgres server on each host.
* Installed Postgres Distributed on each host.
* Configured the Postgres server to work with PGD on each host.

To create the cluster, we tell `host-one`'s Postgres instance that it is a PGD node - `node-one` and create PGD groups on that node.
Then we tell `host-two` and `host-three`'s Postgres instances that they are PGD nodes - `node-two` and `node-three` and that they should join a group on `node-one`.

To create a node, it must be given a name and a connection string which other nodes can use to connect to it.

For each node we want to create a connection string which will allow PGD to preform replication.

## Create connection strings for each node

The connection string is a key/value string which starts with a `host=` and the IP address of the host (or if you have resolvable named hosts, the name of the host).

That is followed by the name of the database; `dbname=bdrbd` as we created a `bdrdb` database when [installing the software](04-installing-software).

We recommend you also add the port number of the server to your connection string as `port=5444` for EDB Postgres Advanced Server and `port=5432` for EDB Postgres Extended and Community PostgreSQL.

Calculate the connection strings for each of your nodes in advance. 
Below are the connection strings for our 3 node example:

| Name       | Node Name  | Private IP      | Connection string                      |
| ---------- | ---------- | --------------- | -------------------------------------- |
| host-one   | node-one   | 192.168.254.166 | host=host-one dbname=bdrdb port=5444   |
| host-two   | node-two   | 192.168.254.247 | host=host-two dbname=bdrdb port=5444   |
| host-three | node-three | 192.167.254.135 | host=host-three dbname=bdrdb port=5444 |

The process will involve:

* Logging into host-one's Postgres server
  * Running `bdr.create_node` to give it a node name (node-one) and connection string
  * Creating a top-level group called `pgd` with `bdr.create_group`
  * Creating a sub-group called `dc1` as a child of `pgd` with `bdr.create_group`
* Logging into host-two's Postgres server
  * Running `bdr.create_node` to give it a node name (node-two) and connection string
  * Running `bdr.join_node_group` with node-one's connection string and group name `dc1`
* Logging into host-three's Postgres server
  * Running `bdr.create_node` to give it a node name (node-three) and connection string
  * Running `bdr.join_node_group` with node-one's connection string and group name `dc1`


## Preparing the first node 

Log into host-one's Postgres server.

```
ssh rocky@host-one
sudo -iu enterprisedb psql bdrdb
```

### Create the first node

Call the [`bdr.create_node`](/pgd/latest/reference/nodes-management-interfaces#bdrcreate_node) function to create a node, passing it the node name and a connection string which other nodes can use to connect to it.

```
select bdr.create_node('node-one','host=host-one dbname=bdrdb port=5444');
```

### Create the top-level group

Call the [`bdr.create_node_group`](/pgd/latest/reference/nodes-management-interfaces#bdrcreate_node_group) function to create a top-level group for your PGD cluster. Passing a single string parameter will create the top-level group with that name. For our example, we will create a top-level group named `pgd`.

```
select bdr.create_node_group('pgd');
```

### Create a sub-group

Call the [`bdr.create_node_group`](/pgd/latest/reference/nodes-management-interfaces#bdrcreate_node_group) function again to create a sub-group of the top-level group. The sub-group name is the first parameter, the parent group is the second parameter. Using sub-groups to organise your nodes is recommended. For our example, we will create a sub-group `dc1` as a child of `pgd`.

```
select bdr.create_node_group('dc1','pgd');
```

## Adding the second node

Log into host-two's Postgres server

```
ssh rocky@host-two
sudo -iu enterprisedb psql bdrdb
```

### Create the second node

We call the [`bdr.create_node`](/pgd/latest/reference/nodes-management-interfaces#bdrcreate_node) function to create this node, passing it the node name and a connection string which other nodes can use to connect to it.

```
select bdr.create_node('node-two','host=host-two dbname=bdrdb port=5444');
```

### Join the node group

Using [`bdr.join_node_group`](/pgd/latest/reference/nodes-management-interfaces#bdrjoin_node_group) we can ask node-two to join node-one's `dc1` group. The function takes as a first parameter the connection string of a node already in the group, and the group name as a second parameter.

```
select bdr.join_node_group('host=host-one dbname=bdrdb port=5444','dc1');
```

## Adding the third node

Log into host-three's Postgres server

```
ssh rocky@host-three
sudo -iu enterprisedb psql bdrdb
```

### Create the second node

We call the [`bdr.create_node`](/pgd/latest/reference/nodes-management-interfaces#bdrcreate_node) function to create this node, passing it the node name and a connection string which other nodes can use to connect to it.

```
select bdr.create_node('node-three','host=host-three dbname=bdrdb port=5444');
```

### Join the node group

Using [`bdr.join_node_group`](/pgd/latest/reference/nodes-management-interfaces#bdrjoin_node_group) we can ask node-three to join node-one's `dc1` group. The function takes as a first parameter the connection string of a node already in the group, and the group name as a second parameter.

```
select bdr.join_node_group('host=host-one dbname=bdrdb port=5444','dc1');
```


